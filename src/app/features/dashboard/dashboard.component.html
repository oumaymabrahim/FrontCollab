<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>Tableau de bord</h1>
    <p *ngIf="currentUser">Bienvenue, {{ currentUser.nom }}</p>
  </div>

  <!-- Loading -->
  <app-loading *ngIf="loading" message="Chargement du tableau de bord..."></app-loading>

  <!-- Contenu principal -->
  <div class="dashboard-content" *ngIf="!loading">

    <!-- Statistiques -->
    <div class="stats-grid">

      <!-- Stats Admin -->
      <ng-container *ngIf="currentUser?.role === Role.ADMIN">
        <div class="stat-card">
          <div class="stat-icon warning">
            <i class="icon icon-clock"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.tachesEnCours || 0 }}</h3>
            <p>Tâches en cours</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon success">
            <i class="icon icon-check"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.tachesTerminees || 0 }}</h3>
            <p>Tâches terminées</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon project">
            <i class="icon icon-folder"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.projetsEnCours || 0 }}</h3>
            <p>Projets actifs</p>
          </div>
        </div>
      </ng-container>

      <!-- Stats Membre d'équipe -->
      <ng-container *ngIf="currentUser?.role === Role.MEMBRE_EQUIPE">
        <div class="stat-card">
          <div class="stat-icon task">
            <i class="icon icon-task"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.mesTaches || 0 }}</h3>
            <p>Mes tâches</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon warning">
            <i class="icon icon-clock"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.tachesEnCours || 0 }}</h3>
            <p>En cours</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon success">
            <i class="icon icon-check"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.tachesTerminees || 0 }}</h3>
            <p>Terminées</p>
          </div>
        </div>
      </ng-container>
    </div>

    <!-- Grille de contenu -->
    <div class="content-grid">

      <!-- Tâches récentes -->
      <div class="content-card" *ngIf="recentTaches.length > 0">
        <div class="card-header">
          <h2>
            <i class="icon icon-task"></i>
            {{ currentUser?.role === Role.MEMBRE_EQUIPE ? 'Mes tâches récentes' : 'Tâches récentes' }}
          </h2>
        </div>
        <div class="card-content">
          <div class="task-list">
            <div class="task-item" *ngFor="let tache of recentTaches">
              <div class="task-info">
                <h4>{{ tache.nom }}</h4>
                <p class="task-description" *ngIf="tache.description">{{ tache.description }}</p>
                <div class="task-meta">
                  <span class="task-statut" [ngClass]="getStatutTacheClass(tache.statut)">
                    {{ tache.statut }}
                  </span>
                  <span class="task-echeance" [ngClass]="{ 'urgent': isEcheanceProche(tache.dateEcheance) }">
                    <i class="icon icon-calendar"></i>
                    {{ formatDate(tache.dateEcheance) }}
                  </span>
                </div>
              </div>
              <div class="task-priority priority-{{ tache.priorite.toLowerCase() }}">
                {{ tache.priorite }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Projets récents -->
      <div class="content-card" *ngIf="recentProjets.length > 0">
        <div class="card-header">
          <h2>
            <i class="icon icon-folder"></i>
            Projets récents
          </h2>
        </div>
        <div class="card-content">
          <div class="project-list">
            <div class="project-item" *ngFor="let projet of recentProjets">
              <div class="project-info">
                <h4>{{ projet.nom }}</h4>
                <p class="project-description" *ngIf="projet.description">{{ projet.description }}</p>
                <div class="project-meta">
                  <span class="project-statut" [ngClass]="getStatutProjetClass(projet.statut)">
                    {{ projet.statut }}
                  </span>
                  <span class="project-echeance" [ngClass]="{ 'urgent': isEcheanceProche(projet.dateEcheance) }">
                    <i class="icon icon-calendar"></i>
                    Échéance: {{ formatDate(projet.dateEcheance) }}
                  </span>
                </div>
              </div>
              <div class="project-budget" *ngIf="projet.budget">
                {{ projet.budget | currency:'EUR':'symbol':'1.0-0' }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Message d'accueil si pas de données -->
      <div class="welcome-card" *ngIf="recentTaches.length === 0 && recentProjets.length === 0">
        <div class="welcome-content">
          <i class="icon icon-star"></i>
          <h2>Bienvenue sur CollabManager!</h2>
          <p *ngIf="currentUser?.role === Role.ADMIN">
            En tant qu'administrateur, vous pouvez gérer les utilisateurs et superviser tous les projets.
          </p>
          <p *ngIf="currentUser?.role === Role.CHEF_DE_PROJECT">
            En tant que chef de projet, vous pouvez créer et gérer des projets et assigner des tâches.
          </p>
          <p *ngIf="currentUser?.role === Role.MEMBRE_EQUIPE">
            En tant que membre d'équipe, vous pouvez consulter et mettre à jour vos tâches assignées.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
